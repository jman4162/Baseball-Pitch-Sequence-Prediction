# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This repository explores baseball pitch sequence prediction using multiple ML approaches. All code lives in Jupyter notebooks (originally developed in Google Colab). There is no build system, test suite, or linting configuration — the project is notebook-driven.

## Running Notebooks

The project uses a Python 3.9 venv at `./venv/`. To run notebooks locally:

```bash
source venv/bin/activate
jupyter notebook
```

Notebooks were originally developed in Google Colab and can be opened there directly via GitHub.

## Architecture

The project follows a pipeline: **synthetic data generation → model training → evaluation**.

### Notebooks (in logical order)

1. **`Baseball_Pitch_Sequence_Simulator.ipynb`** — Generates synthetic training data using enhanced Markov models with pitcher archetypes (power/finesse/slider_specialist/balanced), pitch sequence strategies, fatigue modeling, and game situation context. Outputs `data/baseball_pitch_data.csv` with columns: Balls, Strikes, PitchType, Outcome, PitcherType, PitchNumber, AtBatNumber, RunnersOn, ScoreDiff, PreviousPitchType.

2. **`HMM_Pitch_Predictor.ipynb`** — Generates a second synthetic dataset (`data/synthetic_pitch_sequences.csv`) using an asymmetric transition matrix reflecting setup-pitch patterns. Trains a `CategoricalHMM` from `hmmlearn`, sweeping 1–8 hidden states and selecting by accuracy. Best model saved as `best_sequence_model.pkl`.

3. **`AutoGluon_Baseball_Pitch_Prediction.ipynb`** — Uses AutoGluon TabularPredictor to predict **PitchType** from all available features (Balls, Strikes, PitcherType, PitchNumber, AtBatNumber, RunnersOn, ScoreDiff, PreviousPitchType). Uses `good_quality` preset.

4. **`AutoGluon_Baseball_Pitch_Outcome_Prediction.ipynb`** — Uses AutoGluon TabularPredictor to predict **Outcome** (ball/strike/hit) from all available features including PitchType. Uses `good_quality` preset.

5. **`LSTM_Pitch_Predictor.ipynb`** — Uses a 2-layer LSTM neural network with sliding window (8 pitches) to predict the next PitchType from sequential context. Includes baseline comparisons (most frequent, previous pitch, random weighted).

### Datasets

- **`data/baseball_pitch_data.csv`** — Columns: `Balls, Strikes, PitchType, Outcome, PitcherType, PitchNumber, AtBatNumber, RunnersOn, ScoreDiff, PreviousPitchType`. ~384K rows of simulated game pitches with context. Generated by notebook 1.
- **`data/synthetic_pitch_sequences.csv`** — 2,500 sequences of 100 pitches each (columns `Pitch_1` through `Pitch_100`). Generated by notebook 2 with asymmetric transition matrix.

### Key Dependencies

- `autogluon` (TabularPredictor for AutoML)
- `hmmlearn` (CategoricalHMM)
- `pandas`, `numpy`, `scikit-learn`, `matplotlib`, `seaborn`, `torch`

### Simulator Features

- **Pitcher archetypes**: power (55% FB), finesse (25% FB, 30% CB), slider_specialist (40% SL), balanced (even)
- **Sequence strategies**: 8 defined pitch patterns (e.g., FB-FB→CH, FB-SL→CB) that boost follow-up pitch probability by 15-25%
- **Count-dependent outcomes**: Hit rate varies from 5-6% in pitcher's counts (0-2) to 19-23% in hitter's counts (3-0)
- **Fatigue modeling**: After archetype-specific threshold (80-95 pitches), shift toward fastballs and more balls
- **Game situation**: Runners on base, score differential affect pitch selection and aggression

### Known Limitations

- The LSTM and AutoGluon models should be re-run after data regeneration to verify improved accuracy.
- The README notes planned but not yet implemented: attention-based transformer model.

## Pitch Types and Outcomes

- **Pitch types**: Fastball, Slider, Curveball, Changeup
- **Outcomes**: ball, strike, hit
- **Count states**: (balls, strikes) where balls ∈ [0,3], strikes ∈ [0,2]
